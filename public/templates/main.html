<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Digi-Live</title>
	<style>

	</style>
</head>
<body>
</body>
<script type="text/javascript">
	var NUM_ANTENNAS = null;
    var ANT_LIST = []
	var whichpage = window.location.pathname.replace("/", "") * 1

	//var START_ANTENNA = 1 + ((whichpage - 1) * 20)
	//var STOP_ANTENNA = ((whichpage) * 20)

    if (whichpage === 1){
        ANT_LIST = [1, 2, 3, 4, 9, 10, 11, 12, 17, 18, 19, 20, 25, 26, 27, 28, 33, 34, 35, 36]
    }
    if (whichpage == 2){
        ANT_LIST = [5, 6, 7, 8, 13, 14, 15, 16, 21, 22, 23, 24, 29, 30, 31, 32, 37, 38, 39, 40]
    }


	var IMAGE_WIDTH = 25;
	var BORDER_WIDTH = 1;

	function checkSrc(el){
		var isLoaded = el.complete && el.naturalHeight !== 0;
		if (!isLoaded){
			resetSrc(el)
		}
	}

	function getImage(n){
		return document.getElementById("anttun" + String(n))
	}

	function resetSrc(el){
		var current_src = el.src
		var new_src = current_src.split("?")[0] + "?t=" + new Date().getTime()
		el.src = new_src
		/*setTimeout(function(){
			checkSrc(el)
		}, 200)*/
	}

    function checkImg(n){
        var el = getImage(n)
        if (!el.complete || el.naturalHeight === 0){
            resetSrc(el)
            setTimeout(function(){
                checkImg(n)
            }, 1000)
        }
        else{
            
        }
    }

	function resetSrcs(n){
		var el = getImage(ANT_LIST[n])
		if (el === null || el === undefined){

		}
		else{
			resetSrc(el)
            checkImg(n)
			setTimeout(function(){
				resetSrcs(n + 1)
			}, 100)
		}
	}

    function setSources(){
        for (var i of ANT_LIST){//(var i = START_ANTENNA; i <= STOP_ANTENNA; i++){
            var el = getImage(i)
            el.src = "./images/anttun" + String(i) + ".png?t=" + new Date().getTime()
            el.style.position = "relative"
            el.style.width = "calc(" + String(IMAGE_WIDTH) + "% - " + String(2 * BORDER_WIDTH) + "px)"
            setTimeout(function(){
                checkImg(i)
            }, 1000)
        }
    }

	var req = new XMLHttpRequest;
	req.open("GET", "/totalantennae")
	req.send()
	req.onreadystatechange = function(){
		if (this.readyState == 4 && this.status == 200){
			NUM_ANTENNAS = this.responseText * 1
			//create image elements
            for (var i of ANT_LIST){//(var i = START_ANTENNA; i <= STOP_ANTENNA; i++){
				var el = document.createElement("img")
				el.id = "anttun" + String(i)
				el.style.border = String(BORDER_WIDTH) + "px solid black"
				let n = i;
				el.onclick = function(){
					window.location.replace(window.location.origin + "/chart/" + String(n))
				}
				document.body.appendChild(el)
			}

			//set image sources
            setSources()

			setInterval(function(){
				resetSrcs(0)
			}, 30000)
		}
	}
</script>
</html>
