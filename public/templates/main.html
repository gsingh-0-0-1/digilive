<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Digi-Live</title>
	<style>

	</style>
</head>
<body>
</body>
<script type="text/javascript">
	var NUM_ANTENNAS = null;

	var IMAGE_WIDTH = 50;
	var BORDER_WIDTH = 1;

	function checkSrc(el){
		var isLoaded = el.complete && el.naturalHeight !== 0;
		if (!isLoaded){
			resetSrc(el)
		}
	}

	function getImage(n){
		return document.getElementById("anttun" + String(n))
	}

	function resetSrc(el){
		var current_src = el.src
		var new_src = current_src.split("?")[0] + "?t=" + new Date().getTime()
		el.src = new_src
		/*setTimeout(function(){
			checkSrc(el)
		}, 200)*/
	}

	function resetSrcs(){
		for (var i = 0; i < NUM_ANTENNAS; i++){
			var el = getImage(i + 1)
			resetSrc(el)
		}
	}

	var req = new XMLHttpRequest;
	req.open("GET", "/totalantennae")
	req.send()
	req.onreadystatechange = function(){
		if (this.readyState == 4 && this.status == 200){
			NUM_ANTENNAS = this.responseText * 1
			//create image elements
			for (var i = 0; i < NUM_ANTENNAS; i++){
				var el = document.createElement("img")
				el.id = "anttun" + String(i + 1)
				el.style.border = String(BORDER_WIDTH) + "px solid black"
				let n = i;
				el.onclick = function(){
					window.location.replace(window.location.origin + "/chart/" + String(n + 1))
				}
				document.body.appendChild(el)
			}

			//set image sources
			for (var i = 0; i < NUM_ANTENNAS; i++){
				var el = getImage(i + 1)
				el.src = "images/anttun" + String(i + 1) + ".png?t=" + new Date().getTime()
				el.style.position = "relative"
				el.style.width = "calc(" + String(IMAGE_WIDTH) + "% - " + String(2 * BORDER_WIDTH) + "px)"
			}

			setInterval(resetSrcs, 2000)
		}
	}
</script>
</html>
